name: Complete CI-CD Pipeline
 
################
# EVENT TRIGGERS
################
on:
  # Trigger when code is pushed to main branch
  push:
    branches:
      - main
 
  # Trigger when pull request is created or updated
  pull_request:
    branches:
      - main
 
  # Manual trigger from GitHub UI
  workflow_dispatch:
    inputs:
      environment:
        description: "Select environment for deployment"
        required: true
        default: "dev"
        type: choice
        options:
          - dev
          - qa
          - prod
 
################
# JOBS SECTION
################
jobs:
 
  ########
  # JOB 1: CI JOB
  # Runs on GitHub-hosted runner
  ########
  ci-job:
    name: Continuous Integration
    runs-on: ubuntu-latest
 
    steps:
      # Step 1: Checkout repository code
      - name: Checkout code
        uses: actions/checkout@v4
 
      # Step 2: Simulate build step
      - name: Build application
        run: |
          echo "Building the application..."
          sleep 2
 
      # Step 3: Simulate test execution
      - name: Run tests
        run: |
          echo "Running unit tests..."
          echo "All tests passed!"
 
  ########
  # JOB 2: DEPLOY JOB
  # Runs on self-hosted runner
  ########
  deploy-job:
    name: Deployment Job
    runs-on: self-hosted
    needs: ci-job   # Runs only if CI job succeeds
 
    steps:
      # Step 1: Print deployment environment
      - name: Print environment
        run: |
          echo "Deploying to environment: ${{ github.event.inputs.environment }}"
 
      # Step 2: Simulate deployment
      - name: Deploy application
        run: |
          echo "Starting deployment..."
          echo "Application deployed successfully!"
